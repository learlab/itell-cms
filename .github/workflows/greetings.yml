name: Deploy New Markdown
on:
  workflow_dispatch:
    inputs:
      text:
        description: 'text name'
        required: true
        type: string
      token:
        description: 'github token'
        required: true
        type: string
      owner:
        description: 'designation repo owner'
        required: true
        type: string
      repository:
        description: 'designation repo name'
        required: true
        type: string
      dir:
        description: 'designated repo path'
        required: true
        type: string

jobs:
  build:
    runs-on: ubuntu-latest
    container: pandoc/latex
    steps:
      - name: Install curl
        run: apk add --no-cache curl jq
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '15'
      - name: Use Node.js via nvm
        run: |
          curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash
          export NVM_DIR="$HOME/.nvm"
          [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
          [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"

          nvm install node
          nvm use node
      - name: Create output directory
        run: mkdir -p output
      - name: creates output
        run: node ./testing.js
          echo "Contents of output directory after script:"
          ls -R output
      - name: List contents of the output directory
        run: ls -R output
      - name: Pushes to another repository
        id: push_directory
        uses: cpina/github-action-push-to-another-repository@main
        env:
          SSH_DEPLOY_KEY: ${{ inputs.token }}
        with:
          source-directory: output
          destination-github-username: ${{ inputs.owner }}
          destination-repository-name: ${{ inputs.repository }}
          target-directory: ${{ inputs.dir }}
          user-email: annachen031014@gmail.com
          commit-message: Added new content
          target-branch: main
      - name: Remove File
        uses: JesseTG/rm@v1.0.0
        with:
          path: output
      - name: Test get variable exported by push-to-another-repository
        run: echo $DESTINATION_CLONED_DIRECTORY
